# 名称映射功能说明

## 概述

名称映射功能用于处理不同数据源之间的标题差异。例如，Bangumi中的"7号房的礼物"在Emby中可能是"七号房的礼物"，通过名称映射可以自动处理这种差异。

## 配置方法

### 1. 在配置文件中添加映射

在 `config.conf` 文件中添加 `[NameMapping]` 部分：

```ini
[NameMapping]
# 格式：原始名称 = 映射后的名称
7号房的礼物 = 七号房的礼物
# 可以添加更多映射规则
原始名称1 = 映射后名称1
原始名称2 = 映射后名称2
```

### 2. 使用管理工具

#### 查看当前映射
```bash
python name_mapping_manager.py view
```

#### 添加新映射
```bash
python name_mapping_manager.py add --original "原始名称" --mapped "映射后名称"
```

#### 删除映射
```bash
python name_mapping_manager.py remove --original "原始名称"
```

#### 搜索映射
```bash
python name_mapping_manager.py search --keyword "关键词"
```

#### 清空所有映射
```bash
python name_mapping_manager.py clear
```

## 工作原理

1. **配置文件读取**：所有导入器启动时会从 `config.conf` 的 `[NameMapping]` 部分读取映射规则
2. **自动应用**：在处理RSS数据时，会自动应用名称映射
3. **向后兼容**：如果没有配置映射，会使用默认的映射规则
4. **日志记录**：会记录加载了多少条映射规则

## 使用场景

### 1. 处理不同来源的标题差异
- Bangumi vs Emby 的标题差异
- 豆瓣 vs Emby 的标题差异
- 不同语言版本的标题差异

### 2. 处理特殊字符
- 全角数字 vs 半角数字
- 不同标点符号
- 空格差异

### 3. 处理别名
- 官方名称 vs 常用名称
- 中文名 vs 英文名

## 示例

### 配置文件示例
```ini
[NameMapping]
# 数字差异
7号房的礼物 = 七号房的礼物
3 idiots = 三傻大闹宝莱坞

# 标点符号差异
钢铁侠 = 钢铁侠
Iron Man = 钢铁侠

# 空格差异
复仇者联盟 = 复仇者联盟
复仇者 联盟 = 复仇者联盟

# 语言差异
The Avengers = 复仇者联盟
Avengers = 复仇者联盟
```

### 使用效果
- 当RSS数据中出现"7号房的礼物"时，会自动搜索"七号房的礼物"
- 当RSS数据中出现"The Avengers"时，会自动搜索"复仇者联盟"
- 这样可以提高在Emby中找到匹配项目的成功率

## 注意事项

1. **映射规则优先级**：配置文件中的映射规则会覆盖默认映射
2. **大小写敏感**：映射是大小写敏感的，需要精确匹配
3. **性能影响**：映射规则越多，处理时间越长，建议控制在合理范围内
4. **备份配置**：修改配置文件前建议先备份

## 故障排除

### 映射不生效
1. 检查配置文件格式是否正确
2. 确认原始名称是否完全匹配
3. 查看日志中是否显示"加载名称映射"信息

### 映射规则过多
1. 使用 `view` 命令查看当前所有映射
2. 使用 `search` 命令查找特定映射
3. 使用 `remove` 命令删除不需要的映射

### 配置文件损坏
1. 备份当前配置文件
2. 删除 `[NameMapping]` 部分
3. 重新添加映射规则 